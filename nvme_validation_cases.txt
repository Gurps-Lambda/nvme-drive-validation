NVMe VALIDATION – CONSOLIDATED TEST CASES
========================================

Author: Gurpreet Singh
Script: nvme_validation.sh
Purpose: Standardized NVMe drive validation with structured logging
Scope: Hardware validation, bring-up, manufacturing, RMA triage

------------------------------------------------------------
1. OVERVIEW
------------------------------------------------------------

This document defines all NVMe validation test cases executed by
nvme_validation.sh. The goal is to verify NVMe drive presence,
connectivity, health, performance, and system stability using
short-duration, non-intrusive checks.

The validation is NOT a stress test or endurance benchmark.

------------------------------------------------------------
2. ENVIRONMENT VALIDATION TESTS
------------------------------------------------------------

TC-ENV-01: Root Privilege Check
--------------------------------
Purpose:
- Ensure script is executed with required privileges

Method:
- Verify effective UID (EUID == 0)

Pass Criteria:
- Script is run as root

Fail Criteria:
- Script is not run as root (execution stops)

------------------------------------------------------------
TC-ENV-02: Log Directory and File Creation
------------------------------------------------------------
Purpose:
- Ensure test results are captured persistently

Method:
- Create /var/tmp/hw-validation
- Generate timestamped log file

Pass Criteria:
- Log directory exists
- Log file exists and is writable

Logged Data:
- Log directory path
- Log file name

------------------------------------------------------------
3. NVMe DRIVE DETECTION & LINK VALIDATION
------------------------------------------------------------

TC-LINK-01: NVMe Drive Enumeration
---------------------------------
Purpose:
- Verify NVMe drives are detected by the OS

Method:
- lsblk -dn | grep nvme

Pass Criteria:
- One or more NVMe drives detected

Fail Criteria:
- No NVMe drives detected

Logged Data:
- Number of NVMe drives found

------------------------------------------------------------
TC-LINK-02: Drive Identification
------------------------------------------------------------
Purpose:
- Capture identifying information for traceability

Method:
- lsblk metadata per drive

Logged Data:
- Device path
- Model
- Size
- Serial number

Result:
- Informational

------------------------------------------------------------
TC-LINK-03: PCIe Address Verification
------------------------------------------------------------
Purpose:
- Verify NVMe device is attached to PCIe fabric

Method:
- /sys/block/<drive>/device/address

Logged Data:
- PCIe Bus:Device.Function

Result:
- Informational

------------------------------------------------------------
TC-LINK-04: PCIe Link Speed and Width
------------------------------------------------------------
Purpose:
- Detect degraded PCIe connectivity

Method:
- current_link_speed
- current_link_width
- max_link_speed
- max_link_width

Logged Data:
- Current link speed
- Current link width
- Max supported speed
- Max supported width

Fail / Warn Conditions:
- Link width lower than expected → WARN or FAIL
- Link speed significantly below max → WARN

------------------------------------------------------------
4. SMART & HEALTH VALIDATION
------------------------------------------------------------
TC-SMART-01: SMART Health Self-Assessment
------------------------------------------------------------
Purpose:
- Verify drive reports itself as healthy

Method:
- smartctl -a

Pass Criteria:
- SMART self-assessment = PASSED

Fail Criteria:
- Any other result

------------------------------------------------------------
TC-SMART-02: Critical Warning Flags
------------------------------------------------------------
Purpose:
- Detect NVMe-reported critical issues

Method:
- SMART Critical Warning field

Pass Criteria:
- Critical Warning = 0x00

Fail Criteria:
- Any non-zero value

------------------------------------------------------------
TC-SMART-03: Drive Temperature Check
------------------------------------------------------------
Purpose:
- Ensure thermal conditions are safe

Method:
- SMART temperature reading

Pass Criteria:
- Temperature < 70°C

Fail Criteria:
- Temperature ≥ 70°C

------------------------------------------------------------
TC-SMART-04: Media and Data Integrity Errors
------------------------------------------------------------
Purpose:
- Detect NAND or internal data errors

Method:
- SMART “Media and Data Integrity Errors” counter

Pass Criteria:
- Error count = 0

Fail Criteria:
- Error count > 0

------------------------------------------------------------
5. KERNEL LOG VALIDATION
------------------------------------------------------------

TC-KERNEL-01: NVMe I/O Errors
-----------------------------
Purpose:
- Detect OS-level I/O failures

Method:
- dmesg scan for I/O error patterns

Fail Criteria:
- Any NVMe-related I/O error

------------------------------------------------------------

TC-KERNEL-02: NVMe Link / Controller Errors
-------------------------------------------
Purpose:
- Detect PCIe or controller instability

Method:
- dmesg scan for:
  - link down
  - controller reset
  - nvme controller errors

Fail Criteria:
- Any matching entries

------------------------------------------------------------

TC-KERNEL-03: NVMe Timeouts
---------------------------
Purpose:
- Detect command stalls

Method:
- dmesg scan for timeout patterns

Fail Criteria:
- Any timeout entries

------------------------------------------------------------

TC-KERNEL-04: Firmware or Critical Kernel Errors
------------------------------------------------
Purpose:
- Detect severe system instability

Method:
- dmesg scan for firmware, panic, or fatal errors

Fail Criteria:
- Any matching entries

------------------------------------------------------------
6. SEQUENTIAL PERFORMANCE VALIDATION
------------------------------------------------------------

TC-PERF-READ-01: Sequential Read Performance
--------------------------------------------
Purpose:
- Verify NVMe read bandwidth and latency

Method:
- fio sequential read test
- Block size: 1M
- Runtime: 10 seconds
- Direct I/O

Metrics Collected:
- Bandwidth (MiB/s)
- IOPS
- Average latency (usec)
- Error count

Pass Criteria:
- No fio errors
- Bandwidth above minimum threshold

Fail Criteria:
- fio errors detected
- Critically low bandwidth

------------------------------------------------------------

TC-PERF-WRITE-01: Sequential Write Performance (Optional)
---------------------------------------------------------
WARNING: This test is destructive.

Purpose:
- Verify NVMe write path functionality

Method:
- fio sequential write test
- Block size: 1M
- Runtime: 5 seconds
- Direct I/O

Metrics Collected:
- Bandwidth (MiB/s)
- IOPS
- Average latency
- Error count

Pass Criteria:
- No fio errors
- Stable write throughput

Fail Criteria:
- fio errors
- Near-zero throughput

------------------------------------------------------------
7. RESULT AGGREGATION
------------------------------------------------------------

TC-RESULT-01: Overall Result Calculation
----------------------------------------
Purpose:
- Provide a clear final validation outcome

Method:
- Track total tests executed
- Track PASS / FAIL / WARN counts

Final Result Logic:
- Any FAIL → Overall FAIL
- No FAILs → Overall PASS

------------------------------------------------------------
8. OUTPUT ARTIFACTS
------------------------------------------------------------

Each validation run produces:
- Timestamped log file
- Structured console output
- Per-drive validation results
- Final summary block

------------------------------------------------------------
END OF DOCUMENT
------------------------------------------------------------
